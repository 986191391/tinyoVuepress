# Diff算法步骤

## 创建虚拟 DOM 树

将模板编译生成的 render 函数执行，创建组件的虚拟 DOM 树（VNode）。

## Diff 过程
比较新旧虚拟 DOM 树的差异，并在实际 DOM 上进行相应的更新。Diff 过程采用深度优先遍历算法，从根节点开始比较。

1. 比较节点类型：比较新旧节点的标签名（tag），如果不同，则直接替换整个节点及其子树。

2. 比较节点属性：比较新旧节点的属性（props）和事件监听器（listeners），并更新实际 DOM 上的对应属性和事件。

3. 比较子节点：对新旧节点的子节点进行逐个比较。<br>
如果新节点没有子节点，旧节点有子节点，则移除旧节点的子节点。<br>
如果新节点有子节点，旧节点没有子节点，则添加新节点的子节点。<br>
如果新旧节点都有子节点，则进一步细化比较。

4. Diff 子节点：对新旧节点的子节点列表进行逐对比较。<br>
使用双指针法，在新旧节点的子节点列表中分别设定头尾两个指针。<br>
指针从两端向中间移动，依次比较对应位置的节点。<br>
如果新旧节点相同（key 和 tag 都相同），则递归进行 Diff。<br>
如果没有找到相同的节点，则说明该节点是新节点，需要创建并插入到对应位置。<br>
如果找到相同的节点，则将新节点插入到对应位置，并对该节点进行更新。

5. Diff 完成：当比较完所有子节点后，Diff 过程完成，实际 DOM 上的更新也完成。