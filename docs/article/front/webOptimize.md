# 性能优化

一个小问题：为什么script标签一般都放在body标签的后面呢？

![在这里插入图片描述](http://43.139.113.7:81/img/browser.jpeg)
## 从浏览器的渲染过程来看

1. 解析 HTML 文件，构建 DOM 树，同时浏览器主进程负责下载 CSS 文件
2. CSS 文件下载完成，解析 CSS 文件成树形的数据结构，然后结合 DOM 树合并成 RenderObject 树
3. 布局 RenderObject 树 （Layout/reflow），负责 RenderObject 树中的元素的尺寸，位置等计算
4. 绘制 RenderObject 树 （paint），绘制页面的像素信息
5. 浏览器主进程将默认的图层和复合图层交给 GPU 进程，GPU 进程再将各个图层合成(composite)，最后显示出页面

所以 **只要会对渲染操作阻塞或减慢速度的操作，都是可以进行性能优化的一个方向**

DOM 和 CSSOM 通常是并行构建的，所以 CSS 加载不会阻塞 DOM 的解析。JS是解释执行的，如果最开始就加载JS的文件，在遇到耗时较久的代码时，会阻塞页面的渲染。这也是为什么script标签一般都放在body标签的后面的原因，先让页面渲染后再执行JS。

## 根据页面渲染步骤来优化
进行渲染的时候，所有的图片/html文件等等，都是通过请求来的。
所以如果能够`减少请求的次数`，就是很好的一种优化方式。

1. **减少http请求**，可以通过以下(2、3)方式来减少http的请求的次数
2. **多张图片合成一张，使用雪碧图。**
3. **合并CSS文件。**

当然，如果请求的资源体积越小，请求的速度当然也越快。

4. **资源压缩，减少体积**

假如在一个页面中存在上万张图片。
如果在页面加载时一次性全部请求加载，页面会非常卡顿，这是不现实的。

5. **懒加载**

对于图片、音视频等资源可以在首次初始化界面时只加载当前视口内的资源或处于用户焦点中的那一部分资源，以提高页面渲染速度，从而使用户更轻松得到所需内容。

6. **数据的分页处理**

当页面都已经加载完成了。后续开始进行用户操作时。
当html元素的大小等发生改变时会触发回流的操作。即重渲染。
这是需要消耗内存的，所以我们需要避免对DOM的直接操作。(虚拟dom)

7. **减少DOM操作**

页面在渲染的时候，结合html生成的dom树和cssom树的render，除了减少dom的操作以外，当遇到css表达式时，也会浪费很多的资源。

8. **避免使用CSS表达式**

例如calc() 表达式的使用<br>

安全方面来说，CSS 表达式可以让黑客通过 CSS 类型攻击实现注入代码、恶意重定向和其他攻击行为。例如，黑客可以通过 expression 属性将 Javascript 代码注入到页面中，然后执行具体的攻击行为。

而在性能方面，CSS 表达式是无法缓存的，每次重绘或重新计算时都需要重新计算一遍，因此会降低浏览器的渲染速度。


最后就是代码的层面。

9. **代码质量优化**

减少循环的次数，内存的合理使用和释放，声明合并，循环外提等。<br>
比如实际开发中使用了`window.addEventListener`在页面销毁时要记得`window.removeEventListener`将对应绑定的事件清除，释放内存。

10. **事件委托**

还有一些用户可能会重复点击的地方，为了避免一直出发带来的性能问题。<br>
频繁的用户操作就会让我们联想到 `防抖和节流` 的方法

11. **防抖和节流**

言简易懂: [防抖和节流](https://segmentfault.com/a/1190000018445196)

12. **服务器渲染**

采用服务端化模板渲染，最终生成的 HTML 内容直接发送给客户端，而不是像 SPA 应用那样，在页面加载后等待 JS 操作，从而大幅度减少页面初始化时间。

13. **Webpack 打包优化**

对于 Webpack 插件的使用和配置能够对项目打包过程中占用资源和完成打包时间产生重要影响，如代码分离，懒汉加载、多线程编译、自动预编译等等。

## 其他

- 图片优化：图片是非常重要的资源，因此需要对图片进行优化。可以使用图片压缩工具对图片进行压缩，减小图片的大小，从而提高网站的加载速度。

- 资源合并：将多个CSS或JS文件合并成一个文件，可以减少HTTP请求的次数，从而提高网站的加载速度。

- 资源压缩：对CSS和JS文件进行压缩，可以减小文件的大小，从而提高网站的加载速度。

- CDN加速：使用CDN可以将网站的静态资源分布到全球各地的服务器上，从而提高网站的访问速度。

CDN是内容分发网络（Content Delivery Network）的缩写，是一种通过互联网互相连接的计算机网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，提高用户访问网站的响应速度。CDN的基本原理是将内容缓存在离用户较近的CDN节点上，当用户请求访问该内容时，CDN会将内容从离用户最近的节点传输到用户的终端，从而提高用户访问网站的速度和稳定性。CDN可以有效地减少网络拥塞，提高网站的访问速度和稳定性，是现代互联网应用中不可或缺的一部分。

- 缓存优化：使用浏览器缓存和服务器缓存可以减少HTTP请求的次数，从而提高网站的加载速度。可以参考站内文章：[缓存](http://43.139.113.7:89/article/browser/cache.html)

- 代码优化：前端代码的优化也非常重要。可以使用一些优化技巧，如减少DOM操作、减少HTTP请求、使用异步加载等，从而提高网站的性能。

- 服务器优化：服务器的性能也非常重要。可以使用一些服务器优化技巧，如使用缓存、使用负载均衡、使用CDN等，从而提高服务器的性能。

- 前端框架优化：如果网站使用了前端框架，可以对框架进行优化，从而提高网站的性能。可以使用一些优化技巧，如使用虚拟DOM、使用异步加载、使用懒加载等，从而提高网站的性能。

- 移动端优化：对于移动端网站来说，需要进行一些特殊的优化。可以使用一些优化技巧，如使用响应式设计、使用移动端专用的UI组件、使用移动端专用的图片等，从而提高移动端网站的性能。

- 代码分割：对于大型网站来说，代码分割也非常重要。可以将代码分割成多个小块，从而减少每个页面的加载时间，提高网站的性能。

- 预渲染：预渲染也是一种优化方式。可以使用预渲染技术将网站的静态页面提前生成，从而提高网站的访问速度。

- 服务端渲染：服务端渲染也是一种优化方式。可以使用服务端渲染技术将网站的页面在服务器端生成，从而提高网站的访问速度。

- 使用Web Worker：对于一些计算密集型的任务，可以使用Web Worker来进行处理，从而不会阻塞主线程，提高网站的性能。

- 使用HTTP/2：HTTP/2是一种新的网络协议，可以提高网站的访问速度。可以使用HTTP/2来替代HTTP/1.1，从而提高网站的性能。