# JS事件循环
JavaScript事件循环机制是JavaScript引擎用来处理异步操作和事件处理的机制。它允许JavaScript在单线程的环境中处理并发的任务，以保证代码的执行顺序和响应性能。


经典的，非常经典的问题题目，笔试面试经常提问！
```javascript
setTimeout(() => {
	console.log(1);
}, 0);

new Promise((resolve) => {
	console.log(2);
	resolve();
	console.log(3);
}).then(() => {
	console.log(4);
})

console.log(5);
```


事件循环机制的基本原理如下：

1. 执行栈（Execution Stack）：JavaScript引擎使用执行栈来处理同步代码。执行栈是一个存储函数调用的栈结构，它按照先进后出（LIFO）的顺序执行函数。

2. 任务队列（Task Queue）：任务队列用于存储异步任务的回调函数。当异步任务完成后，其回调函数会被添加到任务队列中。

3. 事件循环（Event Loop）：事件循环是一个持续运行的过程，它不断地检查执行栈和任务队列，以确定是否有任务需要执行。当执行栈为空时，事件循环会从任务队列中取出一个任务，并将其添加到执行栈中执行。

下面是事件循环机制的详细步骤：

1. 执行全局代码：JavaScript引擎从全局作用域开始执行代码，将全局代码添加到执行栈中。

2. 执行栈执行代码：JavaScript引擎按照执行栈的顺序执行函数调用，直到执行栈为空。如果在执行过程中遇到异步任务，比如定时器（setTimeout、setInterval）、网络请求（Ajax）或事件监听器（click事件等），则会将相应的回调函数添加到任务队列中，而不是立即执行。

3. 检查任务队列：当执行栈为空时，事件循环会检查任务队列。如果任务队列中有任务，则会选择一个最先进入队列的任务，并将其对应的回调函数添加到执行栈中执行。这样，异步任务的回调函数将在合适的时机得到执行。

4. 循环重复：事件循环会不断重复上述步骤，即执行栈为空时检查任务队列，并执行相应的任务，直到执行栈和任务队列都为空。

需要注意的是，任务队列中的任务分为宏任务（Macro Task）和微任务（Micro Task）两种类型。宏任务包括整体代码（script）的执行、setTimeout、setInterval等，而微任务包括Promise、MutationObserver等。在每一轮事件循环中，所有的微任务都会在下一个宏任务之前执行。

这种机制保证了JavaScript在单线程的环境中能够处理并发的任务，同时也避免了多线程带来的复杂性和线程安全的问题。通过合理使用异步操作和事件处理，可以提高JavaScript代码的性能和用户体验。


