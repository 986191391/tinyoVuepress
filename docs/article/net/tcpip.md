# TCP/IP

TCP/IP是一组协议，它管理互联网上数据的传输方式。它代表传输控制协议/互联网协议，是网络中最广泛使用的协议套件。

TCP/IP协议是一个协议簇。里面包括很多协议的，TCP、UDP都只是其中的一种， 之所以命名为TCP/IP协议，因为TCP、IP协议是两个很重要的协议，就以它们命名了。

## 分层
TCP/IP是一个分层协议，每个层负责数据传输的特定方面。这些层包括：

- 应用层：该层负责为应用程序提供服务，例如电子邮件、文件传输和Web浏览。在这个层次上的协议包括HTTP、FTP和SMTP等。

- 传输层：该层负责提供可靠的数据传输，例如TCP协议。

- 网络层：该层负责将数据包从源主机传输到目标主机，例如IP协议。

- 数据链路层：该层负责将数据包从一个节点传输到另一个节点，例如以太网协议。

- 物理层：该层负责将数据转换为电信号，并在物理媒介上传输数据，例如光纤和电缆。

在TCP/IP协议中，每个层都有自己的协议和功能。每个层都将数据传输的任务分解为更小的任务，并将这些任务分配给下一层处理。这种分层结构使得网络通信更加可靠和灵活，因为它允许不同的协议在不同的层次上进行交互，并且可以根据需要添加或删除协议。

例如，如果需要在网络层添加一个新的协议来提高网络性能，可以在网络层添加该协议，而不会影响其他层的功能。同样，如果需要更改传输层协议以提高数据传输的可靠性，可以更改传输层协议，而不会影响其他层的功能。这种分层结构使得网络协议的开发和维护更加容易和灵活。

**在TCP/IP协议中，TCP协议使用三次握手建立连接，使用四次挥手关闭连接。**

## 三次握手

客户端向服务器发送一个SYN包，其中SYN标志位被设置为1，表示客户端请求建立连接。

服务器收到SYN包后，向客户端发送一个SYN/ACK包，其中SYN和ACK标志位都被设置为1，表示服务器已经收到客户端的请求，并同意建立连接。

客户端收到SYN/ACK包后，向服务器发送一个ACK包，其中ACK标志位被设置为1，表示客户端已经收到服务器的确认，并建立连接。

这样，TCP连接就建立成功了。在三次握手过程中，客户端和服务器都要发送和接收数据包，以确保连接的可靠性。


在数据传输过程中，TCP协议使用滑动窗口机制来控制发送方和接收方之间的数据流量。发送方会根据接收方的反馈动态调整发送速率，以避免网络拥塞和数据丢失。接收方会根据自己的处理能力和缓存空间来控制数据的接收速率，以避免数据包的积压和丢失。

## 四次挥手

客户端向服务器发送一个FIN包，其中FIN标志位被设置为1，表示客户端已经完成了数据传输，并请求关闭连接。

服务器收到FIN包后，向客户端发送一个ACK包，其中ACK标志位被设置为1，表示服务器已经收到客户端的请求，并进入CLOSE_WAIT状态。此时，服务器可以继续向客户端发送数据包，但不能再接收客户端的数据包。

服务器完成数据传输后，会向客户端发送一个FIN包，其中FIN标志位被设置为1，表示服务器已经完成了数据传输，并请求关闭连接。

客户端收到FIN包后，向服务器发送一个ACK包，其中ACK标志位被设置为1，表示客户端已经收到服务器的关闭请求，并关闭连接。此时，客户端进入TIME_WAIT状态，等待一段时间后才会关闭连接。这是为了确保服务器收到了客户端的ACK包，并且可以处理可能在传输过程中出现的延迟数据包。